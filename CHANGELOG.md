# 更新日志

## v2.3.3 (2026-02-24)

### 🐛 问题修复

- 修复 ArcticDB 时区问题：替换 vnpy `convert_tz` 为自定义 `_to_china_tz`，强制使用北京时间存储
- 修复行情录制引擎启动时大量"合约不存在"日志：延迟批量订阅至合约查询完毕后执行
- 修复通达信导入对话框 InfoBar 定位异常：改用 CaptionLabel 替代
- 修复日期区间对话框默认时间使用本机时区的问题：改用 `beijing_now()`
- 修复全局日志时间戳使用本机时区的问题：loguru 通过 patcher 强制 UTC+8，UI 各窗口统一 `beijing_now()`
- 修复数据库默认时区依赖 `tzlocal` 的问题：硬编码为 `Asia/Shanghai`

### ✨ 功能改进

- 数据管理界面新增 Tick 数据概况、查看和删除功能
- 数据管理界面 K 线数据改为倒序显示（最新数据在前）
- 行情记录界面新增红色"清理失效"按钮，合约查询完毕后启用，一键清理过期合约

---

## v2.3.2 (2026-02-22)

### 🐛 问题修复

- 补充缺失依赖：akshare、pygame
- 修复实时图表窗口顶部控件背景色为白色的问题：为 #chartToolbar 和 #chartContainer 添加背景色样式
- 修复实时图表窗口样式文件加载不完整的问题：补全加载 common.qss 和 window.qss

感谢 [@xiaoqizheng0033](https://github.com/xiaoqizheng0033) 的反馈和修复方案。

---

## v2.3.1 (2026-02-21)

### 🐛 问题修复

- 补全 requirements.txt 缺失依赖：lightweight-charts、pyqtgraph、loguru、pytdx、vnpy-sqlite
- 修复行情记录界面 eventFilter 在初始化阶段访问未创建属性导致崩溃的问题
- 统一数据库入口 `get_database()`，根据配置选择后端（默认 ArcticDB）
- 设置界面数据库类型新增 ArcticDB 选项并设为默认

---

## v2.3.0 (2026-02-19)

### 🎉 新增功能

- 通达信本地数据导入：直接读取通达信安装目录下的二进制 K 线文件（.lc1/.lc5/.day），自动发现合约并批量导入
- 导入对话框支持日线/分钟线/主力指数三种过滤，异步扫描不阻塞 UI
- 设置界面新增通达信目录配置项
- 图表历史条数新增 2000/5000/10000/全部 选项，大数据量加载时显示 InfoBar 提示

---

## v2.2.0 (2026-02-19)

### 🎉 新增功能

- 集成 AKShare 数据服务，支持日线、分钟线和小时线数据下载
- AKShare 一键下载 + 每日 20:00 自动下载和刷新合约
- 设置界面新增自动任务开关（合约更新/数据下载/行情记录）
- 图表支持小时级（1h/2h/4h）和日线级（1日/2日/5日）K 线周期
- 图表工具栏新增历史条数下拉（100/200/500/1000）

### 🐛 问题修复

- 修复合约刷新阻塞 UI 的问题，改用 QThread
- 修复图表 tick 更新时行情回放导致 JS 错误
- 修复监控表格列宽不随内容增长的问题

---

## v2.1.1 (2026-02-15)

### 🐛 问题修复

- 修复主图指标增删后 Legend 条目只增不减的问题
- 修复窗口关闭后无法拖动的问题（恢复 CursorFixMixin.closeEvent）

---

## v2.1.0 (2026-02-14)

### 🎉 新增功能

#### 实时行情图表系统

- 独立图表窗口，支持自定义多周期切换
- 指标插件系统：内置演示 MA、MACD、RSI、海龟通道、KDJ
- 指标信号自动标记（金叉/死叉、超买/超卖等）
- 交易标记：买卖点标记 + 盈亏连线可视化
- 图表方案按合约保存

#### AI 智能分析

- 集成 Claude API 进行图表智能分析
- AI 配置管理窗口（API Key、模型选择）
- 智能提示词模板
- 分析结果展示面板

#### AI 模型管理

- 多 AI 模型配置与切换
- 设置默认模型

---

## v2.0.0 (2026-02-11)

初始发布版本（对应 git tag v2.0.0）
